import './polyfills.server.mjs';
import{b as h}from"./chunk-77RYRIC7.mjs";import{c as p,g as c,m as g,p as u}from"./chunk-NOQO3GIZ.mjs";import{a as m,b as d,d as l}from"./chunk-VVCT4QZE.mjs";var T=(()=>{class n{constructor(e){this.topicService=e,this.progressItemsSubject=new p([]),this.progressItems$=this.progressItemsSubject.asObservable(),this.clearStoredProgress(),this.syncWithTopics()}getProgressItems(){return this.progressItems$}getProgressStats(){return this.progressItems$.pipe(c(e=>{let r=e.length,t=e.filter(i=>i.completed).length,s=r>0?Math.round(t/r*100):0,o=this.calculateEstimatedTimeRemaining(e);return{total:r,completed:t,percentage:s,estimatedTimeRemaining:o}}))}getCompletedItems(){return this.progressItems$.pipe(c(e=>e.filter(r=>r.completed)))}getPendingItems(){return this.progressItems$.pipe(c(e=>e.filter(r=>!r.completed)))}markItemAsCompleted(e){let t=this.progressItemsSubject.value.map(s=>s.id===e&&!s.completed?d(m({},s),{completed:!0,completedDate:new Date().toISOString().split("T")[0]}):s);this.progressItemsSubject.next(t),this.saveProgressToStorage(t)}markItemAsPending(e){let t=this.progressItemsSubject.value.map(s=>{if(s.id===e&&s.completed){let o=s,{completedDate:i}=o,a=l(o,["completedDate"]);return d(m({},a),{completed:!1})}return s});this.progressItemsSubject.next(t),this.saveProgressToStorage(t)}syncWithTopics(){this.topicService.topics$.subscribe(e=>{let r=e.map(t=>({id:t.id,title:t.title,description:t.description,completed:t.isCompleted,completedDate:t.isCompleted?this.getCompletedDate(t.id):void 0,category:t.category,estimatedTime:t.estimatedTime}));this.progressItemsSubject.next(r),this.saveProgressToStorage(r)})}getCompletedDate(e){return this.getStoredProgress().find(s=>s.id===e)?.completedDate||new Date().toISOString().split("T")[0]}calculateEstimatedTimeRemaining(e){let r=e.filter(i=>!i.completed),t=0;r.forEach(i=>{let a=i.estimatedTime;if(a.includes("h")){let I=parseFloat(a.replace("h",""));t+=I*60}});let s=Math.floor(t/60),o=t%60;return s>0?o>0?`${s}h ${o}min`:`${s}h`:`${o}min`}getStoredProgress(){if(typeof window<"u"&&window.localStorage)try{let e=localStorage.getItem("progressItems");return e?JSON.parse(e):[]}catch(e){console.error("Error loading progress from storage:",e)}return[]}saveProgressToStorage(e){if(typeof window<"u"&&window.localStorage)try{localStorage.setItem("progressItems",JSON.stringify(e))}catch(r){console.error("Error saving progress to storage:",r)}}clearStoredProgress(){if(typeof window<"u"&&window.localStorage)try{localStorage.removeItem("progressItems"),console.log("\u{1F9F9} Dados de progresso do localStorage foram limpos")}catch(e){console.error("Error clearing progress storage:",e)}}static{this.\u0275fac=function(r){return new(r||n)(u(h))}}static{this.\u0275prov=g({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();export{T as a};
