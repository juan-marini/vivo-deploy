import './polyfills.server.mjs';
import{H as m,Sa as g,Wa as f,c as h,e as c,hb as p,i as u,j as l,m as a,p as o}from"./chunk-NOQO3GIZ.mjs";var d=(()=>{class r{constructor(e){this.platformId=e}isBrowser(){return g(this.platformId)}getItem(e,t="local"){if(!this.isBrowser())return null;try{return(t==="local"?localStorage:sessionStorage).getItem(e)}catch{return null}}setItem(e,t,s="local"){if(this.isBrowser())try{(s==="local"?localStorage:sessionStorage).setItem(e,t)}catch{}}removeItem(e,t="local"){if(this.isBrowser())try{(t==="local"?localStorage:sessionStorage).removeItem(e)}catch{}}clear(e="local"){if(this.isBrowser())try{(e==="local"?localStorage:sessionStorage).clear()}catch{}}static{this.\u0275fac=function(t){return new(t||r)(o(m))}}static{this.\u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var I={production:!1,apiUrl:"http://localhost:5000/api"};var v=(()=>{class r{constructor(e,t,s){this.http=e,this.router=t,this.storage=s,this.apiUrl=`${I.apiUrl}/auth`,this.tokenKey="vivo_token",this.refreshTokenKey="vivo_refresh_token",this.userKey="vivo_user";let n=this.getStoredUser();this.currentUserSubject=new h(n),this.currentUser=this.currentUserSubject.asObservable()}get currentUserValue(){return this.currentUserSubject.value}login(e){return this.http.post(`${this.apiUrl}/login`,e).pipe(l(t=>{t.success&&t.token&&(this.storeTokens(t.token,t.refreshToken),this.storeUser(t.usuario),this.currentUserSubject.next(t.usuario))}))}logout(){this.getToken()&&this.http.post(`${this.apiUrl}/logout`,{}).subscribe({error:()=>{}}),this.clearStorage(),this.currentUserSubject.next(null),this.router.navigate(["/login"])}refreshToken(){let e=this.getRefreshToken();return e?this.http.post(`${this.apiUrl}/refresh-token`,{refreshToken:e}).pipe(l(t=>{t.success&&t.token&&this.storeTokens(t.token,t.refreshToken)}),u(()=>(this.logout(),c({success:!1,message:"Token refresh failed"})))):c({success:!1,message:"No refresh token"})}forgotPassword(e){return this.http.post(`${this.apiUrl}/esqueci-senha`,{email:e})}isAuthenticated(){let e=this.getToken();if(!e)return!1;try{let t=this.parseJwt(e);if(!t)return!1;let s=Date.now()/1e3;return t.exp>s}catch{return!1}}getToken(){return this.storage.getItem(this.tokenKey,"session")||this.storage.getItem(this.tokenKey,"local")}getRefreshToken(){return this.storage.getItem(this.refreshTokenKey,"session")||this.storage.getItem(this.refreshTokenKey,"local")}storeTokens(e,t){let s=this.storage.getItem("rememberedEmail","local")?"local":"session";this.storage.setItem(this.tokenKey,e,s),t&&this.storage.setItem(this.refreshTokenKey,t,s)}storeUser(e){let t=this.storage.getItem("rememberedEmail","local")?"local":"session";this.storage.setItem(this.userKey,JSON.stringify(e),t)}getStoredUser(){let e=this.storage.getItem(this.userKey,"session")||this.storage.getItem(this.userKey,"local");if(e)try{return JSON.parse(e)}catch{return null}return null}clearStorage(){this.storage.removeItem(this.tokenKey,"session"),this.storage.removeItem(this.refreshTokenKey,"session"),this.storage.removeItem(this.userKey,"session");let e=this.storage.getItem("rememberedEmail","local");this.storage.removeItem(this.tokenKey,"local"),this.storage.removeItem(this.refreshTokenKey,"local"),this.storage.removeItem(this.userKey,"local"),e&&this.storage.setItem("rememberedEmail",e,"local")}parseJwt(e){try{let s=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(s).split("").map(k=>"%"+("00"+k.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(n)}catch{return null}}static{this.\u0275fac=function(t){return new(t||r)(o(f),o(p),o(d))}}static{this.\u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var i=function(r){return r.ADMIN="Administrador",r.COLABORADOR="Colaborador",r.GESTOR="Gestor",r}(i||{}),B=(()=>{class r{constructor(e){this.authService=e,this.currentUser=null,this.authService.currentUser.subscribe(t=>{this.currentUser=t})}getCurrentUser(){return this.currentUser}getUserRole(){return this.currentUser?.perfil||i.COLABORADOR}isAdmin(){let e=this.getUserRole();return e===i.ADMIN||e==="Administrador"}isGestor(){let e=this.getUserRole();return e===i.GESTOR||e==="Gest\xE3o"||this.isAdmin()}isColaborador(){let e=this.getUserRole();return e===i.COLABORADOR||e==="Desenvolvimento"||e==="Infraestrutura"||e==="QA"||e==="Produto"||e==="Dados"||e==="Design"}getWelcomeMessage(){let e=this.getCurrentUser();return e?`Seja bem-vindo(a), ${e.nomeCompleto.split(" ")[0]}`:"Seja bem-vindo(a)"}getNavigationItems(){let e=this.isGestor(),t=this.isColaborador();return[{label:"Home",route:"/home",icon:"fas fa-home",visible:t},{label:"Meu Progresso",route:"/progresso",icon:"fas fa-chart-line",visible:t},{label:"Dashboard",route:"/dashboard",icon:"fas fa-tachometer-alt",visible:e}].filter(s=>s.visible)}getDefaultRoute(){return this.isGestor()?"/dashboard":"/home"}canAccessRoute(e){return this.getNavigationItems().some(s=>s.route===e)}hasPermission(e){let t=this.getUserRole();return{[i.ADMIN]:["dashboard","users","reports","home","progress"],[i.GESTOR]:["dashboard","reports"],[i.COLABORADOR]:["home","progress","topics"]}[t]?.includes(e)||!1}getAvailableRoutes(){return this.isGestor()?["/dashboard"]:["/home","/progresso","/topic"]}static{this.\u0275fac=function(t){return new(t||r)(o(v))}}static{this.\u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{I as a,d as b,v as c,B as d};
