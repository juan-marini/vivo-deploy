import './polyfills.server.mjs';
import{b as u}from"./chunk-77RYRIC7.mjs";import{a as i}from"./chunk-TJ446NKF.mjs";import{Wa as c,a as p,c as h,e as l,g as b,i as d,m as n,p as s}from"./chunk-NOQO3GIZ.mjs";var g=(()=>{class t{constructor(e){this.http=e,this.apiUrl=`${i.apiUrl}/progress`,this.teamMembersSubject=new h([]),this.teamMembers$=this.teamMembersSubject.asObservable(),this.loadTeamMembers()}loadTeamMembers(){this.getTeamMembersFromApi().subscribe({next:e=>{this.teamMembersSubject.next(e)},error:e=>{console.error("Erro ao carregar membros da equipe do backend:",e),this.loadMembersFromStorage()}})}getTeamMembersFromApi(){return this.http.get(`${this.apiUrl}/members`).pipe(b(e=>e.map(r=>this.mapDtoToTeamMember(r))),d(e=>(console.error("API Error:",e),l([]))))}mapDtoToTeamMember(e){return{id:e.id,name:e.name,role:e.role,startDate:e.startDate,progress:e.progress,status:this.mapStringToStatus(e.status),avatarUrl:e.avatarUrl,department:e.department,phone:e.phone,admissionDate:e.admissionDate,lastLogin:e.lastLogin,isActive:e.isActive,team:e.team}}mapStringToStatus(e){switch(e.toLowerCase()){case"conclu\xEDdo":case"concluido":return"Conclu\xEDdo";case"em andamento":case"em progresso":return"Em andamento";case"n\xE3o iniciado":case"nao iniciado":return"N\xE3o iniciado";case"atrasado":return"Atrasado";case"iniciando":return"Atrasado";default:return"N\xE3o iniciado"}}getTeamMembers(){return this.teamMembers$}refreshTeamMembers(){console.log("Recarregando membros da equipe do backend..."),this.clearCache(),this.loadTeamMembers()}forceRefreshTeamMembers(){console.log("For\xE7ando refresh completo dos dados..."),this.clearCache(),this.getTeamMembersFromApiWithTimestamp().subscribe({next:e=>{this.teamMembersSubject.next(e)},error:e=>{console.error("Erro ao for\xE7ar refresh dos membros:",e)}})}clearCache(){if(typeof window<"u"&&window.localStorage)try{localStorage.removeItem("teamMembers")}catch(e){console.log("Could not clear localStorage cache:",e)}}getTeamMembersFromApiWithTimestamp(){let e=new Date().getTime();return this.http.get(`${this.apiUrl}/members?_t=${e}`).pipe(b(r=>r.map(a=>this.mapDtoToTeamMember(a))),d(r=>(console.error("API Error with timestamp:",r),l([]))))}loadMembersFromStorage(){if(typeof window<"u"&&window.localStorage)try{let e=localStorage.getItem("teamMembers");if(e){let r=JSON.parse(e);this.teamMembersSubject.next(r)}else this.loadDefaultTeamMembers()}catch(e){console.error("Error loading team members from storage:",e),this.loadDefaultTeamMembers()}}loadDefaultTeamMembers(){this.teamMembersSubject.next([])}static{this.\u0275fac=function(r){return new(r||t)(s(c))}}static{this.\u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var A=(()=>{class t{constructor(e,r,a){this.http=e,this.topicService=r,this.teamService=a}getTeamMembers(){return this.teamService.getTeamMembers()}refreshMemberProgress(){console.log("Atualizando dados dos membros do backend..."),this.teamService.forceRefreshTeamMembers()}getChartData(){return new p(e=>{let r=this.getTeamMembers().subscribe({next:a=>{let m=this.calculateStatusCounts(a),o=a.length,f=[{label:"Conclu\xEDdo",value:o>0?Math.round(m.completed/o*100):0,color:"#10B981"},{label:"Em andamento",value:o>0?Math.round(m.inProgress/o*100):0,color:"#8B5CF6"},{label:"N\xE3o iniciado",value:o>0?Math.round(m.notStarted/o*100):0,color:"#6B7280"},{label:"Atrasado",value:o>0?Math.round(m.delayed/o*100):0,color:"#EF4444"}];e.next(f),e.complete()},error:a=>{e.error(a)}});return()=>r.unsubscribe()})}calculateStatusCounts(e){return e.reduce((r,a)=>{switch(a.status){case"Conclu\xEDdo":r.completed++;break;case"Em andamento":r.inProgress++;break;case"Atrasado":r.delayed++;break;default:r.notStarted++}return r},{completed:0,inProgress:0,notStarted:0,delayed:0})}resetAllMembersData(){console.log("Resetting all member data...");let e=`${i.apiUrl}/progress/fix-database`;this.http.post(e,{}).subscribe({next:r=>{console.log("Database reset successful:",r),this.refreshMemberProgress()},error:r=>{console.error("Error resetting database:",r),this.refreshMemberProgress()}})}getMemberDetailedProgress(e){let r=`${i.apiUrl}/progress/member/${e}`;return this.http.get(r)}static{this.\u0275fac=function(r){return new(r||t)(s(c),s(u),s(g))}}static{this.\u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();export{A as a};
